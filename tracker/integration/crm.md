service: tracker
service_name: K☆50:Трекер
last_modified: 2016-03-09

#Интеграция с CRM

Вы можете интегрировать в К50:Трекер данные о заказах из собственной CRM. При корректной интеграции трекер сопоставит все заказы после online заявок на сайте и после звонков по телефону (при подключенном коллтрекинге).
Информацию о сопоставленных заказах можно экспортировать в К50 Статистику, Google Analytics либо в любую другую систему с помощью API трекера.


##Предварительные приготовления

**Заказы после отправки заявки на сайте**

Все заказы, совершенные после отправки заявки на сайте (будем называть их online заказами) сопоставляются по идентификатору сеанса (sid) и пользователя (uuid), выданные трекером. Поэтому для сопоставления online заказов следует передавать эти параметры в CRM.

Получить параметры можно с помощью метода `getResultData()` объекта `k50TrackerInstance` (данный javascript объект создаётся во время инициализации счетчика), который возвращает объект с требуемыми идентификаторами.
Иными словами, идентификаторы можно получить следующим образом:

Идентификатор сеанса
```javascript
var sid = k50TrackerInstance.getResultData().sid
```
Идентификатор пользователя
```javascript
var uuid = k50TrackerInstance.getResultData().uuid
``` 

**Заказы после звонка клиента**

Заказы, совершенные после звонка клиента (будем относить их к offline заказам), сопоставляются иначе, поскольку передача идентификатора сеанса для них невозможна.
Данные заказы сопоставляются по номер телефона, с которого **звонил клиент**. Поэтому следует обеспечить отправку таких данных в CRM (часто в CRM сохраняют только номер, указанный пользователем в качестве контактного)

##Подготовка фида с данными

Данные о заказах принимаются в виде CSV фида. К50:Трекер должен иметь доступ по ссылке к данному фиду.

**Формат фида**

Формат файла - `CSV`
Разделитель - `;`
Кодировка - `UTF-8`

**Название заголовков файла**

**Жирным** отмечены обязательные поля

|Заголовок|Описание|
|---------|--------|
|**date**|Дата созадния заказа. Формат: **YYYY-MM-DD HH:MM:SS**|
|**orderId**|Идентификатор заказа в системе CRM клиента|
|**callerPhone**|Номер телефона, с которого звонил клиент. Формат **7XXXXXXXXXX**. Если номер не указан в CRM, оставляем пустым|
|**sid**|Идентификатор сеанса. Если его нет в CRM, оставляем пустым|
|**uuid**|Идентификатор пользователя. Если его нет в CRM, оставляем пустым|
|amount|Количество товаров в заказе.|
|margin|Суммарная прибыль(маржа) с заказа|
|revenue|Суммарный доход с заказа|
|comment|Комментарий к заказу|
|type|Тип заказа. Возможные значения: **online**, **offline**. Если не указан, определяется автоматически (есть sid, uuid - online, иначе offline)|